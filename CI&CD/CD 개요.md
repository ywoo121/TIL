# CD 
: 지속적인 배포 또는 지속적 배포 자동화로, 소프트웨어를 자동으로 테스트하고 프로덕션 환경에 배포하는 프로세스
- `Continuous Delivery` -> 더 가깝다
  - 코드가 지속적으로 CI
  - 자동화된 테스트
  - 스테이징 환경가지 자동 배포
  - 프로덕션 배포 (실제 사용자에게)는 수동으로 수행
- `Continuous Deployment` 
  - Continous Delivery의 연장선
  - 별도의 승인없이 프로덕션 환경에까지 배포
  - 점진적으로 Continuos Deployment로 발전해가는 전략도 있음

## 사용 이유
프로덕션 업데이트를 빠르고 신뢰성 있게
- **빠른 릴리스 주기**: 새로운 기능과 수정 사항을 신속하게 제공 가능
- **신뢰성 향상**: 휴먼에러 감소 (-> 코드 품질과 배포의 신뢰성을 높일 수 있음)
- **지속적인 가치 제공**
- **효율성 증가**: 반복 작업을 줄인다
- **릴리스 리스크 감소**: 작은 단위의 변경 사항을 자주 배포 (-> 대규모 배포에서 발생할 수 있는 리스크 감소)

## 사용 방법
1. **코드 변경 및 통합**  
   : 코드 변경 사항을 푸시하면 CI 파이프라인과 통합
2. **자동 테스트**
3. **배포 준비**
4. **프로덕션 배포**
   - Continous Delivery
   - Continous Deployment
5. **모니터링 및 롤백** 

## CD에서 고려해야 할 추가 사항
### 배포 전략
- **Blue - Green** : 안정성을 가장 중요하게 여기는 배포 전략  
  - 현재 운영 중인 환경 (Blue) -> 트래픽을 받도록 처리
  - 새 환경 (Green) -> 배포
    - 롤백 용이성이 좋다.
    - 인프라 비용이 두 배이다. (Green은 트래픽이 없기 때문에 자원 낭비일수도)

- **Rolling**  
  : 서버 그룹을 나누어 점진적으로 업데이트, 무중단 배포가 가능
  - 버전 호환성 문제 발생 가능

- **Canary**
  : 전체 트래픽 중 일부만 새 버전에 보내보고 안정성을 검증한 뒤, 점진적으로 트래픽을 늘려나가는 방법
  - 새로운 버그나 문제점을 조기에 파악할 수 있음
  - 좀 큰 규모의 서비스에서 새로운 기능을 배포할 때 사용했다고 하심
  - Rolling보다는 많이 쓰는 듯

- **A/B 테스트**
  - 새로운 기능이나 변경 사항을 일부 사용자에게만 제공, 기존 버전과 비교 분석한 후 최적의 버전을 선택
  - 사용자 피드백(데이터 기반...)을 바탕으로 제품의 개선 방향을 결정할 수 있음
  - 기간이 필요하다
  - 점진적으로 적용을 해나간다.

> 하나만 사용하는 게 아니라 여러 개 혼합해서 사용하기도 함

### 배포 관측(Observility)과 모니터링
- CI/CD는 '빌드->테스트->배포'쁀먼 아니라 모니터링을 하고 문제를 조기에 발견하는 게 중요함
- 매트릭: 시스템의 성능 지표

### 실무 도입 시 장애물
- 조직 문화
- 보안 규제
- 레거시 시스템 연동: 오래된 시스템과 연동 시, 매번 테스트 환경을 구성하기 까다로울 수 있어, CI/CD를 점진적으로 도입하는 전략 필요

### 현업 사례
- 스타트업
- 대기업 / 금융권


### 환경 관리
> Continous Deployment에서 중요한 요소  
> 
> 환경을 적절히 설정하고 유지하는 것을 포함
1. 환경 분리  
: 개발, 테스트, 스테이징, 프로덕션 환경을 분리하여 각 환경에서 독립적으로 애플리케이션 배포하고 검증
- 개발: 공유 환경, 자유롭게 배포, 확인, 테스트 가능
- 스테이징: 프로덕션 환경과 최대한 유사한 환경 (여기서 QA팀이 테스트)
  - 최종적인 점검을 하는 곳
  - 규모가 작으면 스테이징 환경을 쓰지 않기도
- 프로덕션: 최종 사용자에게 서비스를 제공하는 환경

2. 인프라 코드화
: ex. Terraform, AWS CloudFormation 등의 도구를 사용해 인프라를 코드로 관리

3. 시크릿 관리  
: 환경 별로 다른 API 키, 데이터베이스 비밀번호 등의 시크릿을 안전하게 관리하고, 적절한 환경에서만 접근 가능
- 보안 강화, 민감한 정보 보호 가능

### CD 도구 설명
1. Genkins
: 오픈 소스 CI/CD 서버, 수많은 *플러그인*을 통해 빌드, 테스트, 배포 파이프라인을 구성할 수 있다. 다양한 배포 전략과 환경 관리 지원
- 장점: 유연한 커스터마이징, 대규모 프로젝트에 적합, 플러그인 생태계가 풍부함, 온프레미스와 클라우드 환경 모두 지원
- 단점: 설정 복잡, 러닝커브가 높다. 서버에 직접 설치하고 관리해야 하므로 관리 부담이 된다. 
```
pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                sh 'make build'
            }
        }
        stage('Test') {
            steps {
                sh 'make test'
            }
        }
        stage('Deploy') {
            steps {
                sh 'make deploy'
            }
        }
    }
}

```
2. Github Actions  
: Github 리포지토리에서 직접 워크플로우를 정의하고 실행할 수 있음. 빌드와 배포를 하나의 파이프라인으로 설정할 수 있음
- 장점: Github와의 통합, 쉬운 설정, 자동화된 배포 지원
- 단점: 느리다, 커스터마이징이 지원이 덜 될 수 있다. (Jenkins에 비해), 플러그인 생태계가 아직 부족하다. Github에 제공하는 클라우드에 종속되어 있다. 
```yml
name: CD Pipeline

on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Build
      run: npm run build
    - name: Deploy
      run: npm run deploy


```
3. CircleCI   
: 클라우드 기반 CI/CD 도구, 빠르고 간단하게 파이프라인 설정 가능 / Docker 컨테이너를 사용해 환경을 설정하고 빌드 및 배포 수행
- 장점: 빠른 빌드, Docker와의 강력한 통합, 병렬 처리 및 캐싱 지원, GUI 제공
- 단점: 커스터마이징 옵션 제한, 클라우드만 가능하다.

4. GitLab CI/CD
- 특징: GitLab에 내장된 CI/CD 도구로, GitLab 리포지토리에서 직접 파이프라인을 정의하고 실행할 수 있습니다. 고급 CD 기능을 제공하며, 다양한 배포 전략을 지원합니다.
- 장점: GitLab과의 통합, 강력한 CD 기능, Kubernetes와의 연계 가능

> Jenkins와 Githu Action의 차이점을 위주로 공부하기

### 기타 기능
- Feature Flage
- DevSecOps
  - 금융권이나 공공기관처럼 규제가 엄격한 환경에서는, 배포 자동화 전에 보안 스캔(SAST, DAST)을 자동으로 실행하는 경우가 많습니다.
  - 각 스테이징 단계마다 보안 요건을 체크하고, 승인되어야만 다음 단계로 넘어가는 ‘게이트(Gate)’를 설정해 **DevSecOps** 문화를 구현합니다.
- 멀티 클라우드 배포
  - 특정 클라우드 서비스에 종속되지 않기 위해 AWS, Azure, GCP 등 여러 클라우드에 분산 배포하는 기능
- 즉각적 롤백 vs. 롤 포워드
  - 롤백: 이전 안정 버전으로 즉시 되돌려 장애를 해결
  - 롤 포워드: 문제 수정 커밋을 빠르게 반영해 새 버전을 다시 배포